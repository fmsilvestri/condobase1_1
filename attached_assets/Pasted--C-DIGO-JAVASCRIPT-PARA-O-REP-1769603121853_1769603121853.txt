// ================================================================
// CÃ“DIGO JAVASCRIPT PARA O REPLIT - COPIE E COLE
// ================================================================

// ============================================================
// CONFIGURAÃ‡ÃƒO DO SUPABASE
// ============================================================
// Certifique-se de ter isso no inÃ­cio do seu cÃ³digo:

const supabaseUrl = 'SUA_URL_DO_SUPABASE';
const supabaseKey = 'SUA_CHAVE_PUBLICA_DO_SUPABASE';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// ============================================================
// FUNÃ‡ÃƒO PARA CADASTRAR HÃ“SPEDE
// ============================================================

async function cadastrarHospede(formData) {
  try {
    // Preparar os dados com os nomes EXATOS das colunas do banco
    const dadosParaInserir = {
      condominium_id: formData.condominiumId,
      nome_hospede: formData.nomeHospede,
      cpf: formData.cpf || null,
      telefone: formData.telefone || null,
      email: formData.email || null,
      placa_veiculo: formData.placaVeiculo || null,
      modelo_veiculo: formData.modeloVeiculo || null,
      cor_veiculo: formData.corVeiculo || null,  // â­ ATENÃ‡ÃƒO AQUI!
      observacoes: formData.observacoes || null,
      status: 'ativo'
    };

    console.log('ğŸ“¤ Enviando dados:', dadosParaInserir);

    // Fazer o INSERT no Supabase
    const { data, error } = await supabase
      .from('hospedagens')
      .insert([dadosParaInserir])
      .select();

    // Verificar se houve erro
    if (error) {
      console.error('âŒ Erro do Supabase:', error);
      throw new Error(error.message);
    }

    console.log('âœ… Sucesso! Dados inseridos:', data);
    return { sucesso: true, dados: data };

  } catch (erro) {
    console.error('âŒ Erro ao cadastrar:', erro);
    return { sucesso: false, erro: erro.message };
  }
}

// ============================================================
// EXEMPLO DE USO COM FORMULÃRIO HTML
// ============================================================

// Se vocÃª tem um formulÃ¡rio HTML, use assim:
document.getElementById('formCadastro')?.addEventListener('submit', async (event) => {
  event.preventDefault();

  // Pegar valores do formulÃ¡rio
  const formData = {
    condominiumId: document.getElementById('condominium_id').value,
    nomeHospede: document.getElementById('nome_hospede').value,
    cpf: document.getElementById('cpf').value,
    telefone: document.getElementById('telefone').value,
    email: document.getElementById('email').value,
    placaVeiculo: document.getElementById('placa_veiculo').value,
    modeloVeiculo: document.getElementById('modelo_veiculo').value,
    corVeiculo: document.getElementById('cor_veiculo').value,  // â­ ATENÃ‡ÃƒO!
    observacoes: document.getElementById('observacoes').value
  };

  // Mostrar loading
  const btnSubmit = event.target.querySelector('button[type="submit"]');
  const textoOriginal = btnSubmit.textContent;
  btnSubmit.textContent = 'Cadastrando...';
  btnSubmit.disabled = true;

  // Chamar a funÃ§Ã£o
  const resultado = await cadastrarHospede(formData);

  // Restaurar botÃ£o
  btnSubmit.textContent = textoOriginal;
  btnSubmit.disabled = false;

  // Mostrar resultado
  if (resultado.sucesso) {
    alert('âœ… HÃ³spede cadastrado com sucesso!');
    event.target.reset();
  } else {
    alert('âŒ Erro ao cadastrar: ' + resultado.erro);
  }
});

// ============================================================
// EXEMPLO DE HTML DO FORMULÃRIO
// ============================================================

const exemploHTML = `
<form id="formCadastro">
  <input type="text" id="condominium_id" placeholder="ID do CondomÃ­nio" required>
  <input type="text" id="nome_hospede" placeholder="Nome do HÃ³spede" required>
  <input type="text" id="cpf" placeholder="CPF">
  <input type="text" id="telefone" placeholder="Telefone">
  <input type="email" id="email" placeholder="Email">
  
  <!-- CAMPOS DO VEÃCULO -->
  <input type="text" id="placa_veiculo" placeholder="Placa do VeÃ­culo">
  <input type="text" id="modelo_veiculo" placeholder="Modelo do VeÃ­culo">
  <input type="text" id="cor_veiculo" placeholder="Cor do VeÃ­culo">
  
  <textarea id="observacoes" placeholder="ObservaÃ§Ãµes"></textarea>
  
  <button type="submit">Cadastrar HÃ³spede</button>
</form>
`;

// ============================================================
// TESTE RÃPIDO - INSIRA UM HÃ“SPEDE TESTE
// ============================================================

async function testeRapido() {
  const dadosTeste = {
    condominiumId: 'cole-aqui-um-uuid-valido',
    nomeHospede: 'JoÃ£o da Silva',
    cpf: '123.456.789-00',
    telefone: '(11) 98765-4321',
    placaVeiculo: 'ABC-1234',
    modeloVeiculo: 'Gol',
    corVeiculo: 'Preto',
    observacoes: 'Teste de cadastro'
  };

  const resultado = await cadastrarHospede(dadosTeste);
  console.log('Resultado do teste:', resultado);
}

// Para executar o teste, descomente a linha abaixo:
// testeRapido();

// ============================================================
// LISTAR HOSPEDAGENS (BONUS)
// ============================================================

async function listarHospedagens(condominiumId = null) {
  try {
    let query = supabase.from('hospedagens').select('*');
    
    if (condominiumId) {
      query = query.eq('condominium_id', condominiumId);
    }
    
    const { data, error } = await query.order('created_at', { ascending: false });

    if (error) throw error;

    console.log('ğŸ“‹ Hospedagens:', data);
    return data;

  } catch (erro) {
    console.error('âŒ Erro ao listar:', erro);
    return [];
  }
}

// ============================================================
// ATUALIZAR HÃ“SPEDE (BONUS)
// ============================================================

async function atualizarHospede(id, novosDados) {
  try {
    const { data, error } = await supabase
      .from('hospedagens')
      .update(novosDados)
      .eq('id', id)
      .select();

    if (error) throw error;

    console.log('âœ… HÃ³spede atualizado:', data);
    return { sucesso: true, dados: data };

  } catch (erro) {
    console.error('âŒ Erro ao atualizar:', erro);
    return { sucesso: false, erro: erro.message };
  }
}

// ============================================================
// DELETAR HÃ“SPEDE (BONUS)
// ============================================================

async function deletarHospede(id) {
  try {
    const { error } = await supabase
      .from('hospedagens')
      .delete()
      .eq('id', id);

    if (error) throw error;

    console.log('âœ… HÃ³spede deletado com sucesso');
    return { sucesso: true };

  } catch (erro) {
    console.error('âŒ Erro ao deletar:', erro);
    return { sucesso: false, erro: erro.message };
  }
}

// ================================================================
// CHECKLIST DE VERIFICAÃ‡ÃƒO
// ================================================================

console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  CHECKLIST - VERIFIQUE ANTES DE USAR     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ Executei o script SQL no Supabase?
â–¡ A tabela 'hospedagens' foi criada?
â–¡ Configurei supabaseUrl e supabaseKey?
â–¡ Os IDs dos campos HTML estÃ£o corretos?
â–¡ Testei a conexÃ£o com testeRapido()?

Se todos estiverem âœ…, vocÃª estÃ¡ pronto!
`);